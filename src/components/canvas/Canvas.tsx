// // data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAAAXNSR0IArs4c6QAAD6BJREFUeF7t28FxVEkQRdHGIYzAcIzAIViOZiVxg694VTqzJpv6J5O4q/n28h8BAgQIEAgC38KMEQIECBAg8BIQR0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpshAgQIEBAQN0CAAAECSUBAEpsh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

import React, { useRef, useState } from 'react';
import { ImageDimensions } from '../../constants';
import { writeCanvasState, subscribeOnNewSnapshot } from '../../util/db';

const Canvas = () => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  function drawPixel(event: React.MouseEvent<HTMLCanvasElement>) {
    event.preventDefault();
    event.stopPropagation();

    const canvas = canvasRef.current;
    const rect = canvas?.getBoundingClientRect();

    if (rect && canvas) {
      const mouseX = event.clientX - rect.left;
      const mouseY = event.clientY - rect.top;

      const ctx = canvas.getContext('2d');
      if (ctx) {
        const imageData = ctx.createImageData(4, 4);

        // Cada pixel tiene 4 valores
        for (let i = 0; i < imageData.data.length; i += 4) {
          imageData.data[i + 0] = 190; // R
          imageData.data[i + 1] = 0; // G
          imageData.data[i + 2] = 210; // B
          imageData.data[i + 3] = 255; // A
        }

        const x = Math.floor(mouseX / 4) * 4;
        const y = Math.floor(mouseY / 4) * 4;
        ctx.putImageData(imageData, x, y);
      }
    }
  }

  const submitCanvas = () => {
    const canvas = canvasRef.current;
    const dataurl = canvas?.toDataURL();

    if (dataurl) {
      writeCanvasState(dataurl);
    }
  };

  return (
    <>
      <canvas
        onClick={drawPixel}
        ref={canvasRef}
        style={{ outline: '3px dotted black', zIndex: 999999 }}
        id="pixelCanvas"
        width={ImageDimensions.width}
        height={ImageDimensions.height}
      />

      <button onClick={submitCanvas}>submit me</button>
    </>
  );
};

export default Canvas;
